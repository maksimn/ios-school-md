# iOS-Dev. 16.

---

Отступление про DevOps.

Это CI, CD.

---

Для моков на ObjC - библиотека OCMock

---

Тесты также являются документацией для других разработчиков.

---

Интеграционное = Функциональное тестирование (синонимы) - тестируются сценарии

В СБОЛ - интеграционные UI-тесты. Ловят крэши. Регрес-ошибки.

---

Mock - эмуляция инстанса класса зависимости

Stub - заглушка интерфейсная (заглушка интерфейса). Стаб интерфейса под какой-то заданный возвращаемый результат.

Dummy

Fake - класс, с какой-то фиксированной логикой, возвращающей набор данных (для примера).

---

Тест перформанс экзампл - никто не использует.

---

XCTest используется для UI-тестов. Но в СБОЛе его нет.

Был EarlGray от Google.

---

Как посмотреть покрытие кода тестами? Окружение, code coverage. Prj -> Edit Schemes
-> Test -> Options

---

Record UI Test

Сгенерировался тест с помощью рекордера.

---

OCMock - библиотека для ускорения создания тестов и создания окружения для тестируемых классов - моков объектов и стабить интерфейсы.

Клонируем OCMock с гитхаба.

OCMock работает на основе работы с Runtime.

Пусть у нас есть какой-то класс, и мы хотим сделать его мок. Он берет класс, создает новый инстанс наследника этого класса в рантайме. Возвращает инстанс этого мока. 

При попытке обратиться к методам класса-родителя, он будет перехватывать эти сообщения и отправлять их этому моку. Если мок не реализует эти методы, то ничего не будет происходить, всё будет игнорироваться. Поэтому есть интерфейс-стабы, которые будут возвращать какой-то результат.

Билдим OCMock для iOS'a. Command + B.

Билдим под симулятор, остальные архитектуры не нужны. Артефакты билда лежат в определенной директории. Products -> OCMock.framework -> Show in Finder

Берем и копируем эту библиотеку в наш проект. Для этого препод даже создал специальную директорию Externals, куда засунул этот бинарник.

Заходим в тестовый таргет, Build Phases, Link Binary with Libraries добавляем OCMock из Externals.

Должен быть не файл-бинарь, а файл-фреймворк.

Command + B - сборка таргет приложения

Command + Shift + B - сборка для тестирования

У этого тестового таргета должен быть хост апп связанный, чтобы выполнить экзекьютабл тип бинарника.

Host Application - это главное приложение.

OCMock падает в рантайме, он не подключен.

Подключить OCMock: Copy files , Destination ... frameworks

---

Пусть у нас есть сервис, который делает абстрактный запрос. Пусть получение массива помидоров.

Нам нужно создать инстанс этого сервиса.

Хотим, чтобы возвращал список моделек, наследников `NSObject` с какими-то полями.

Замокать зависимости тестируемого класса через OCMock. В Swift эти моки надо написать ручками. Тогда надо внедрять зависимости, писать протоколы.

---

Правильно каждый класс закрывать протоколом.

Пусть есть сервис, у которого метод принимает объект, отвечающий за доступность сервиса.

---

Есть [~03:05:00]

`OCMClassMock`

`OCMProtocolMock` - аргумент - протокол, а не класс

`OCMStrictMock`

`OCMPartialMock` - чтобы стабить приватные методы. Чтобы они не дергали из себя большой стек вызовов.

