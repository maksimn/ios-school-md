# JS. Объекты.

## 0. Основы объектов

__Объект JS__ – это набор собственных свойств + свойства, унаследованные от другого объекта, который называется __прототипом__.

Каждое свойство имеет __имя__ и __значение__, а также (advanced) __атрибуты свойства__ (writable, enumerable, configurable).

=> __Каждый объект имеет связанный с ним прототип!__

Также каждый объект имеет 3 связанных с ним __атрибута объекта__: 

* __Прототип объекта__ – это ссылка на другой объект, от которого наследуются свойства.
* __Класс объекта__ – строка, которая определяет тип объекта.
* __Флаг extensible__ – определяет, могут ли к данному объекту быть добавлены новые свойства.

3 категории объектов JS:

* __Нативные объекты__ – объект или класс объектов, определённый спецификацией ECMAScript (`Array`, `function`, `RegExp`, `Date` и другие).
* __Объекты хоста__ – объекты, определяемые окружением, в котором исполняется JS код (например, `HTMLElement` в браузере).
* Объекты, определяемые разработчиком.

## 1. Создание объектов

Объекты в JS можно создать тремя способами:

Как объекты-литералы 

```js      
var tree = { name: "Apple", height: 2.0 }; 
```

С помощью оператора `new`

```js
var a = new Array();
```

С помощью функции `Object.create()`

Эта функция создаёт новый объект, используя первый аргумент в качестве прототипа для этого нового объекта. Необязательный второй аргумент задаёт свойства этого нового объекта:

```js
var o1 = Object.create({x:1, y:2});
```

## 2. Get- и set-методы

В ECMASript 5 значение свойства объекта может быть заменено одним или двумя методами, известными как __get-метод__ и __set-метод__.

Свойства, определяемые get- и set-методами, иногда называют __свойствами доступа__ (_accessor properties_), чтобы отличить их от обычных __свойств данных__ (_data properties_), имеющих простой смысл.

В качестве примера рассмотрим объект, представляющий точку. Он имеет обычные свойства данных x и y, хранящие декартовы координаты объекта, а также свойства доступа, эквивалентные полярным коодинатам данной точки:

```js
   var p = {
      // x and y are regular read-write data properties.
      x: 1.0,
      y: 1.0,
      // r is a read-write accessor property with getter and setter.
      // Don't forget to put a comma after accessor methods.
      get r() { return Math.sqrt(this.x*this.x + this.y*this.y); },
      set r(newvalue) {
         var oldvalue = Math.sqrt(this.x*this.x + this.y*this.y);
         var ratio = newvalue/oldvalue;
         this.x *= ratio;
         this.y *= ratio;
      },
      // theta is a read-only accessor property with getter only.
      get theta() { return Math.atan2(this.y, this.x); }
   };
```

## 3. Атрибуты свойств

Свойство имеет имя и значение, а также атрибуты. ECMAScript 5 позволяет изменять эти атрибуты (ECMAScript 3 - нет).

Наличие атрибутов свойств полезно в первую очередь разработчикам библиотек. Они позволяют:

* Создавать "неперечисляемые" методы объектов (подобные встроенным методам объектов).
* Создавать свойства, которые не могут быть изменены или удалены.

В итоге, __свойство__ – это __имя__ + __4 атрибута__:

Для __свойства данных__ это

* атрибут value (значение)
* атрибут writable
* атрибут configurable
* атрибут enumerable

Для __свойства доступа__ это

* атрибут set
* атрибут get
* атрибут configurable
* атрибут enumerable

__Дескриптор свойства__ – это объект, который представляет набор из четырёх атрибутов:

Соответственно, для свойства данных это 

```
   { value: [some value],
     writable: [true or false],
     enumerable: [true or false],
     configurable: [true or false] },
```

а для свойства доступа –

```
   { set: [some function],
     get: [some function],
     enumerable: [true or false],
     configurable: [true or false] }
```

Для работы с дескриптором свойства нужно применять специальные методы, добавленные только в ECMAScript 5.

Чтобы получить дескриптор свойства, применяется метод

```js
   Object.getOwnPropertyDescriptor({x: 1}, "x");
```

В данном случае он вернёт 

```
   { value: 1, writable: true, enumerable: true, configurable: true }
```

Чтобы получить атрибуты свойства или создать новое свойство с заданными атрибутами – 

```js
   var o = {};
   Object.defineProperty(o, "x", { value: 1, writable: true, enumrable: false, configurable: true });
```

Или используйте метод `Object.defineProperties()` для более чем одного свойства.

### 4. Атрибуты объекта

Атрибут prototype

Задаёт объект, от которого данный объект наследует свойства.

Когда слово `prototype` появляется в коде, оно относится к обычному свойству объекта, а не к атрибуту.

__Атрибут prototype__ задаётся в момент создания объекта –

* Объекты, создаваемые через литералы объекта, используют `Object.prototype` в качестве их прототипа.
* Объекты, создаваемые через оператор `new`, используют значение свойства `prototype` функции конструктора в качестве их прототипа.
* Объекты, создаваемые через `Object.create()`, используют первый аргумент этой функции в качестве их прототипа.

Вы можете получить прототип объекта, передав этот объект функции `Object.getPrototypeOf()`.
Часто является возможным определение прототипа объекта `o` через выражение `o.constructor.prototype`.

Чтобы определить, является ли данный объект прототипом (или частью цепочки прототипов) для другого объекта, используйте метод `isPrototypeOf()`.

__Атрибут class__ 

Это строка, которая предоставляет информацию о типе данного объекта.

Метод `toString()` по умолчанию (унаследованный от `Object.prototype`) возвращает строку вида

```
   [object class]
```

__Атрибут extensible__

Задаёт, могут ли быть новые свойства добавлены к объекту, или нет.

С этим атрибутом связаны методы:

```js
   Object.isExtensible()
   Object.preventExtensions()
   Object.seal()
   Object.isSealed()
   Object.freeze()
   Object.isFrozen()
```

### 5. Методы Object

Кроме унаследованных от `Object.prototype` методов `hasOwnProperty()`, `propertyIsEnumerable()`, `isPrototypeOf()`, у (почти) любого объекта JS есть методы

```
   toString()
   toLocaleString()
   toJSON()
   valueOf()
```

### 6. Сериализация объектов

Это процесс преобразования состояния объекта в строку, из которого он впоследствии может быть восстановлен. 

За это отвечают функции

```js
   JSON.stringify()
   JSON.parse()
```

### 7. Проверка объектов на наличие свойств

Проверка свойства на наличие (три способа):

```js
"x" in o;
o.hasOwnProperty("x");
o.x
```

Проверка, является ли свойство собственным и перечислимым:

```js
o.propertyIsEnumerable("x");
```

### 8. Перечисление свойств

Итерация по свойствам объекта производится с помощью цикла `for` вида:

```js
for(p in o) {
   console.log(p);
}
```
